<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Unscented Kalman Inversion · EnsembleKalmanProcesses.jl</title><meta name="title" content="Unscented Kalman Inversion · EnsembleKalmanProcesses.jl"/><meta property="og:title" content="Unscented Kalman Inversion · EnsembleKalmanProcesses.jl"/><meta property="twitter:title" content="Unscented Kalman Inversion · EnsembleKalmanProcesses.jl"/><meta name="description" content="Documentation for EnsembleKalmanProcesses.jl."/><meta property="og:description" content="Documentation for EnsembleKalmanProcesses.jl."/><meta property="twitter:description" content="Documentation for EnsembleKalmanProcesses.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="EnsembleKalmanProcesses.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">EnsembleKalmanProcesses.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../literated/sinusoid_example/">Simple example</a></li><li><a class="tocitem" href="../examples/Cloudy_example/">Cloudy</a></li><li><a class="tocitem" href="../examples/lorenz_example/">Lorenz</a></li><li><a class="tocitem" href="../literated/loss_minimization/">Minimization Loss</a></li><li><a class="tocitem" href="../literated/loss_minimization_sparse_eki/">Sparse Minimization Loss</a></li><li><a class="tocitem" href="../literated/aerosol_activation/">Aerosol activation</a></li><li><a class="tocitem" href="../examples/darcy/">Darcy flow</a></li><li><a class="tocitem" href="../examples/sinusoid_example_toml/">TOML interface</a></li><li><a class="tocitem" href="../examples/ClimateMachine_example/">HPC interfacing example: ClimateMachine</a></li><li><a class="tocitem" href="../examples/template_example/">Template</a></li></ul></li><li><a class="tocitem" href="../defaults/">List of default configurations</a></li><li><a class="tocitem" href="../ensemble_kalman_inversion/">Ensemble Kalman Inversion</a></li><li><a class="tocitem" href="../gauss_newton_kalman_inversion/">Gauss Newton Kalman Inversion</a></li><li><a class="tocitem" href="../ensemble_kalman_sampler/">Ensemble Kalman Sampler</a></li><li class="is-active"><a class="tocitem" href>Unscented Kalman Inversion</a><ul class="internal"><li><a class="tocitem" href="#Algorithm"><span>Algorithm</span></a></li><li><a class="tocitem" href="#Choice-of-free-parameters"><span>Choice of free parameters</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Solution"><span>Solution</span></a></li><li class="toplevel"><a class="tocitem" href="#utki"><span>Output-scalable variant: Unscented Transform Kalman Inversion</span></a></li><li><a class="tocitem" href="#Using-UTKI"><span>Using UTKI</span></a></li></ul></li><li><a class="tocitem" href="../learning_rate_scheduler/">Learning rate schedulers</a></li><li><a class="tocitem" href="../parameter_distributions/">Prior distributions</a></li><li><a class="tocitem" href="../observations/">Observations and Minibatching</a></li><li><a class="tocitem" href="../update_groups/">Update Groups</a></li><li><a class="tocitem" href="../localization/">Localization and SEC</a></li><li><a class="tocitem" href="../accelerators/">Accelerators</a></li><li><a class="tocitem" href="../inflation/">Inflation</a></li><li><a class="tocitem" href="../failure_handling/">Failure handling</a></li><li><a class="tocitem" href="../parallel_hpc/">Parallelism and HPC</a></li><li><a class="tocitem" href="../internal_data_representation/">Internal data representation</a></li><li><a class="tocitem" href="../visualization/">Visualization</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li><input class="collapse-toggle" id="menuitem-21" type="checkbox"/><label class="tocitem" for="menuitem-21"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../API/ParameterDistributions/">ParameterDistributions</a></li><li><a class="tocitem" href="../API/Observations/">Observations</a></li><li><a class="tocitem" href="../API/DataContainers/">DataContainers</a></li><li><a class="tocitem" href="../API/EnsembleKalmanProcess/">EnsembleKalmanProcess</a></li><li><a class="tocitem" href="../API/Inversion/">Inversion</a></li><li><a class="tocitem" href="../API/Unscented/">Unscented</a></li><li><a class="tocitem" href="../API/Sampler/">Sampler</a></li><li><a class="tocitem" href="../API/SparseInversion/">SparseInversion</a></li><li><a class="tocitem" href="../API/TOMLInterface/">TOML Interface</a></li><li><a class="tocitem" href="../API/Localizers/">Localizers</a></li><li><a class="tocitem" href="../API/Visualize/">Visualize</a></li></ul></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Unscented Kalman Inversion</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Unscented Kalman Inversion</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/EnsembleKalmanProcesses.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/EnsembleKalmanProcesses.jl/blob/main/docs/src/unscented_kalman_inversion.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="uki"><a class="docs-heading-anchor" href="#uki">Unscented Kalman Inversion</a><a id="uki-1"></a><a class="docs-heading-anchor-permalink" href="#uki" title="Permalink"></a></h1><p>One of the ensemble Kalman processes implemented in <code>EnsembleKalmanProcesses.jl</code> is the unscented Kalman inversion (<a href="https://doi.org/10.1016/j.jcp.2022.111262">Huang, Schneider, Stuart, 2022</a>). The unscented Kalman inversion (UKI) is a derivative-free method for approximate Bayesian inference. This page additionally documents an output-scalable variant, the <a href="#utki">unscented transform Kalman inversion</a> (UTKI).</p><p>We seek to find the posterior parameter distribution <span>$\theta \in \mathbb{R}^p$</span> from the inverse problem</p><p class="math-container">\[ y = \mathcal{G}(\theta) + \eta\]</p><p>where <span>$\mathcal{G}$</span> denotes the forward map, <span>$y \in \mathbb{R}^d$</span> is the vector of observations and <span>$\eta \sim \mathcal{N}(0, \Gamma_y)$</span> is additive Gaussian noise. Note that <span>$p$</span> is the size of the parameter vector <span>$\theta$</span> and <span>$d$</span> is taken to be the size of the observation vector <span>$y$</span>. The UKI algorithm has the following properties</p><ul><li>UKI has a fixed ensemble size, with members forming a quadrature stencil (rather than the random positioning of the particles from methods such as EKI). There are two quadrature options, <code>symmetric</code> (a <span>$2p + 1$</span>-size stencil), and <code>simplex</code> (a <span>$p+2$</span>-size stencil).</li><li>UKI has uncertainty quantification capabilities, it gives both mean and covariance approximation (no ensemble collapse and no empirical variance inflation) of the posterior distribution, the 3-sigma confidence interval covers the truth parameters for perfect models.</li></ul><h2 id="Algorithm"><a class="docs-heading-anchor" href="#Algorithm">Algorithm</a><a id="Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm" title="Permalink"></a></h2><p>The UKI applies the unscented Kalman filter to the following stochastic dynamical system</p><p class="math-container">\[\begin{aligned}
  &amp;\textrm{evolution:}    &amp;&amp;\theta_{n+1} = r + \alpha (\theta_{n}  - r) +  \omega_{n+1}, &amp;&amp;\omega_{n+1} \sim \mathcal{N}(0,\Sigma_{\omega}),\\
  &amp;\textrm{observation:}  &amp;&amp;y_{n+1} = \mathcal{G}(\theta_{n+1}) + \nu_{n+1}, &amp;&amp;\nu_{n+1} \sim \mathcal{N}(0,\Sigma_{\nu}).
\end{aligned}\]</p><p>The free parameters in the UKI are <span>$\alpha, r, \Sigma_{\nu}, \Sigma_{\omega}$</span>. The UKI updates both the mean <span>$m_n$</span> and covariance <span>$C_n$</span> estimations of the parameter vector <span>$\theta$</span> as following</p><ul><li>Prediction step :</li></ul><p class="math-container">\[\begin{aligned}
    \hat{m}_{n+1} = &amp; r+\alpha(m_n-r)\\
    \hat{C}_{n+1} = &amp; \alpha^2 C_{n} + \Sigma_{\omega}
\end{aligned}\]</p><ul><li>Generate sigma points (&quot;the ensemble&quot;) :</li></ul><p>For the <code>sigma_points = symmetric</code> quadrature option, the ensemble is generated as follows.</p><p class="math-container">\[\begin{aligned}
    &amp;\hat{\theta}_{n+1}^0 = \hat{m}_{n+1} \\
    &amp;\hat{\theta}_{n+1}^j = \hat{m}_{n+1} + c_j [\sqrt{\hat{C}_{n+1}}]_j \quad (1\leq j\leq J)\\ 
    &amp;\hat{\theta}_{n+1}^{j+J} = \hat{m}_{n+1} - c_j [\sqrt{\hat{C}_{n+1}}]_j\quad (1\leq j\leq J)
\end{aligned}\]</p><p>where <span>$[\sqrt{C}]_j$</span> is the <span>$j$</span>-th column of the Cholesky factor of <span>$C$</span>. </p><ul><li>Analysis step :</li></ul><p class="math-container">\[   \begin{aligned}
        &amp;\hat{y}^j_{n+1} = \mathcal{G}(\hat{\theta}^j_{n+1}) \qquad \hat{y}_{n+1} = \hat{y}^0_{n+1}\\
         &amp;\hat{C}^{\theta p}_{n+1} = \sum_{j=1}^{2J}W_j^{c}
        (\hat{\theta}^j_{n+1} - \hat{m}_{n+1} )(\hat{y}^j_{n+1} - \hat{y}_{n+1})^T \\
        &amp;\hat{C}^{pp}_{n+1} = \sum_{j=1}^{2J}W_j^{c}
        (\hat{y}^j_{n+1} - \hat{y}_{n+1} )(\hat{y}^j_{n+1} - \hat{y}_{n+1})^T + \Sigma_{\nu}\\
        &amp;m_{n+1} = \hat{m}_{n+1} + \hat{C}^{\theta p}_{n+1}(\hat{C}^{pp}_{n+1})^{-1}(y - \hat{y}_{n+1})\\
        &amp;C_{n+1} = \hat{C}_{n+1} - \hat{C}^{\theta p}_{n+1}(\hat{C}^{pp}_{n+1})^{-1}{\hat{C}^{\theta p}_{n+1}}{}^{T}\\
    \end{aligned}\]</p><p>Where the coefficients <span>$c_j, W^c_j$</span> are given by</p><p class="math-container">\[    \begin{aligned}
    &amp;c_j = a\sqrt{J}, \qquad W_j^{c} = \frac{1}{2a^2J}~(j=1,\cdots,2N_{\theta}), \qquad  a=\min\{\sqrt{\frac{4}{J}},  1\} 
    \end{aligned}\]</p><h2 id="Choice-of-free-parameters"><a class="docs-heading-anchor" href="#Choice-of-free-parameters">Choice of free parameters</a><a id="Choice-of-free-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Choice-of-free-parameters" title="Permalink"></a></h2><p>The free parameters in the unscented Kalman inversion are <span>$\alpha, r, \Sigma_{\nu}, \Sigma_{\omega}$</span>, which are chosen based on theorems developed in <a href="https://doi.org/10.1016/j.jcp.2022.111262">Huang et al, 2021</a></p><ul><li><p>the vector <span>$r$</span> is set to be the prior mean</p></li><li><p>the scalar <span>$\alpha \in (0,1]$</span> is a regularization parameter, which is used to overcome ill-posedness and overfitting. A practical guide is </p><ul><li>When the observation noise is negligible, and there are more observations than parameters (identifiable inverse problem) <span>$\alpha = 1$</span> (no regularization)</li><li>Otherwise <span>$\alpha &lt; 1$</span>. The smaller <span>$\alpha$</span> is, the closer the UKI mean will converge to the prior mean.</li></ul></li><li><p>the matrix <span>$\Sigma_{\nu}$</span> is the artificial observation error covariance. We set <span>$\Sigma_{\nu} = 2 \Gamma_{y}$</span>, which makes the inverse problem consistent. </p></li><li><p>the matrix <span>$\Sigma_{\omega}$</span> is the artificial evolution error covariance. We set <span>$\Sigma_{\omega} = (2 - \alpha^2)\Lambda$</span>. We choose <span>$\Lambda$</span> as following</p><ul><li>when there are more observations than parameters (identifiable inverse problem), <span>$\Lambda = C_n$</span>, which is updated as the estimated covariance <span>$C_n$</span> in the <span>$n$</span>-th every iteration. This guarantees the converged covariance matrix is a good approximation to the posterior covariance matrix with an uninformative prior.</li></ul><ul><li>otherwise <span>$\Lambda = C_0$</span>, this allows that the converged covariance matrix is a weighted average between the posterior covariance matrix with an uninformative prior and <span>$C_0$</span>.</li></ul></li></ul><p>In short, users only need to change the <span>$\alpha$</span> (<code>α_reg</code>), and the frequency to update the <span>$\Lambda$</span> to the current covariance (<code>update_freq</code>). The user can first try <code>α_reg = 1.0</code> and <code>update_freq = 0</code> (corresponding to <span>$\Lambda = C_0$</span>).</p><div class="admonition is-info" id="Preventing-ensemble-divergence-8d53d79a41e67570"><header class="admonition-header">Preventing ensemble divergence<a class="admonition-anchor" href="#Preventing-ensemble-divergence-8d53d79a41e67570" title="Permalink"></a></header><div class="admonition-body"><p>If UKI suffers divergence (for example when inverse problems are not well-posed), one can prevent it by using Tikhonov regularization (see <a href="https://doi.org/10.1016/j.jcp.2022.111262">Huang, Schneider, Stuart, 2022</a>). It is used by setting the <code>impose_prior = true</code> flag. In this mode, the free parameters are fixed to <code>α_reg = 1.0</code>, <code>update_freq = 1</code>. </p></div></div><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><h3 id="Initialization"><a class="docs-heading-anchor" href="#Initialization">Initialization</a><a id="Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization" title="Permalink"></a></h3><p>An unscented Kalman inversion object can be created using the <code>EnsembleKalmanProcess</code> constructor by specifying the <code>Unscented()</code> process type.</p><p>Creating an ensemble Kalman inversion object requires as arguments:</p><ol><li>The mean value of the observed outputs, a vector of size <code>[d]</code>;</li><li>The covariance of the observational noise, a matrix of size <code>[d × d]</code>;</li><li>The <code>Unscented()</code> process type.</li></ol><p>The initialization of the <code>Unscented()</code> process requires prior mean and prior covariance, and the the size of the observation <code>d</code>. And user defined hyperparameters  <code>α_reg</code> and <code>update_freq</code>.</p><pre><code class="language-julia hljs">using EnsembleKalmanProcesses
using EnsembleKalmanProcesses.ParameterDistributions


# need to choose regularization factor α ∈ (0,1],  
# when you have enough observation data α=1: no regularization
α_reg =  1.0
# update_freq 1 : approximate posterior covariance matrix with an uninformative prior
#             0 : weighted average between posterior covariance matrix with an uninformative prior and prior
update_freq = 0

process = Unscented(prior_mean, prior_cov; α_reg = α_reg, update_freq = update_freq)
ukiobj = EnsembleKalmanProcess(truth_sample, truth.obs_noise_cov, process)
</code></pre><p>Note that no information about the forward map is necessary to initialize the Unscented process. The only forward map information required by the inversion process consists of model evaluations at the ensemble elements, necessary to update the ensemble.</p><h3 id="Constructing-the-Forward-Map"><a class="docs-heading-anchor" href="#Constructing-the-Forward-Map">Constructing the Forward Map</a><a id="Constructing-the-Forward-Map-1"></a><a class="docs-heading-anchor-permalink" href="#Constructing-the-Forward-Map" title="Permalink"></a></h3><p>At the core of the forward map <span>$\mathcal{G}$</span> is the dynamical model <span>$\Psi:\mathbb{R}^p \rightarrow \mathbb{R}^o$</span> (running <span>$\Psi$</span> is usually where the computational heavy-lifting is done), but the map <span>$\mathcal{G}$</span> may include additional components such as a transformation of the (unbounded) parameters <span>$\theta$</span> to a constrained domain the dynamical model can work with, or some post-processing of the output of <span>$\Psi$</span> to generate the observations. For example, <span>$\mathcal{G}$</span> may take the following form:</p><p class="math-container">\[\mathcal{G} = \mathcal{H} \circ \Psi \circ \mathcal{T}^{-1},\]</p><p>where <span>$\mathcal{H}:\mathbb{R}^o \rightarrow \mathbb{R}^d$</span> is the observation map and <span>$\mathcal{T}$</span> is the transformation from the constrained to the unconstrained parameter space, such that <span>$\mathcal{T}(\phi)=\theta$</span>. A family of standard transformations and their inverses are available in the <code>ParameterDistributions</code> module.</p><h3 id="Updating-the-Ensemble"><a class="docs-heading-anchor" href="#Updating-the-Ensemble">Updating the Ensemble</a><a id="Updating-the-Ensemble-1"></a><a class="docs-heading-anchor-permalink" href="#Updating-the-Ensemble" title="Permalink"></a></h3><p>Once the unscented Kalman inversion object <code>UKIobj</code> has been initialized, any number of updates can be performed using the inversion algorithm.</p><p>A call to the inversion algorithm can be performed with the <code>update_ensemble!</code> function. This function takes as arguments the <code>UKIobj</code> and the evaluations of the forward map at each element of the current ensemble. The <code>update_ensemble!</code> function then stores the new updated ensemble and the inputted forward map evaluations in <code>UKIobj</code>.</p><p>The forward map <span>$\mathcal{G}$</span> maps the space of unconstrained parameters <span>$\theta$</span> to the outputs <span>$y \in \mathbb{R}^d$</span>. In practice, the user may not have access to such a map directly. And the map is a composition of several functions. The <code>update_ensemble!</code> uses only the evalutaions <code>g_ens</code> but not the forward map  </p><p>For implementational reasons, the <code>update_ensemble</code> is performed by computing analysis stage first, followed by a calculation of the next sigma ensemble. The first sigma ensemble is created in the initialization.</p><pre><code class="language-julia hljs"># Given:
# Ψ (some black box simulator)
# H (some observation of the simulator output)
# prior (prior distribution and parameter constraints)

N_iter = 20 # Number of steps of the algorithm
 
for n in 1:N_iter
    ϕ_n = get_ϕ_final(prior, ukiobj) # Get current ensemble in constrained &quot;ϕ&quot;-space
    G_n = [H(Ψ(ϕ_n[:, i])) for i in 1:J]  # Evaluate forward map
    g_ens = hcat(G_n...)  # Reformat into `d x N_ens` matrix
    EnsembleKalmanProcesses.update_ensemble!(ukiobj, g_ens) # Update ensemble
end</code></pre><h2 id="Solution"><a class="docs-heading-anchor" href="#Solution">Solution</a><a id="Solution-1"></a><a class="docs-heading-anchor-permalink" href="#Solution" title="Permalink"></a></h2><p>The solution of the unscented Kalman inversion algorithm is a Gaussian distribution whose mean and covariance can be extracted from the &#39;&#39;last ensemble&#39;&#39; (i.e., the ensemble after the last iteration). The sample mean of the last ensemble is also the &quot;optimal&quot; parameter (<code>θ_optim</code>) for the given calibration problem. These statistics can be accessed as follows: </p><pre><code class="language-julia hljs"># mean of the Gaussian distribution, also the optimal parameter for the calibration problem
θ_optim = get_u_mean_final(ukiobj)
# covariance of the Gaussian distribution
sigma_optim = get_u_cov_final(ukiobj)</code></pre><p>There are two examples: <a href="../examples/lorenz_example/#Lorenz-example">Lorenz96</a> and <a href="../examples/Cloudy_example/#Cloudy-example">Cloudy</a>.</p><h1 id="utki"><a class="docs-heading-anchor" href="#utki">Output-scalable variant: Unscented Transform Kalman Inversion</a><a id="utki-1"></a><a class="docs-heading-anchor-permalink" href="#utki" title="Permalink"></a></h1><p>Unscented transform Kalman inversion (UTKI) is a variant of UKI based on applying the woodbury formula used in the ensemble transform Kalman filter (<a href="http://doi.org/10.1175/1520-0493(2001)129&lt;0420:ASWTET&gt;2.0.CO;2">Bishop et al., 2001</a>) to UKI update. It is a form of square-root inversion for UKI is that it has better scalability as the observation dimension grows: while the naive implementation of UKI scales as <span>$\mathcal{O}(p^3)$</span> in the observation dimension <span>$p$</span>, UTKI scales as <span>$\mathcal{O}(p)$</span>. This, however, refers to the online cost. UTKI may have an offline cost of <span>$\mathcal{O}(p^3)$</span> if <span>$\Gamma$</span> is not easily invertible; see below.</p><p>UTKI requires the inverse observation noise covariance, <span>$\Gamma^{-1}$</span>. In typical applications, when <span>$\Gamma$</span> is diagonal, this will be cheap to compute; however, if <span>$p$</span> is very large and <span>$\Gamma$</span> has non-trivial cross-covariance structure, computing the inverse may be prohibitively expensive.</p><div class="admonition is-info" id="Creating-scalable-observational-covariances-6080d535e0e29788"><header class="admonition-header">Creating scalable observational covariances<a class="admonition-anchor" href="#Creating-scalable-observational-covariances-6080d535e0e29788" title="Permalink"></a></header><div class="admonition-body"><p>UTKI requires storing and inverting the observation noise covariance, <span>$\Gamma^{-1}$</span>. Without care, this can be prohibitively expensive. To this end, we have tools and an API for creating and using scalable or compact representations of covariances that are necessary for scalability. See <a href="../observations/#building-covariances">here</a> for details and examples. </p></div></div><h2 id="Using-UTKI"><a class="docs-heading-anchor" href="#Using-UTKI">Using UTKI</a><a id="Using-UTKI-1"></a><a class="docs-heading-anchor-permalink" href="#Using-UTKI" title="Permalink"></a></h2><p>An UTKI struct can be created using the <code>EnsembleKalmanProcess</code> constructor by specifying the <code>TransformUnscented</code> process. Configurables, such as keywords are identical to that of the <code>Unscented</code> process.</p><pre><code class="language-julia hljs">using EnsembleKalmanProcesses
# given the prior distribution `prior`, data `y` and covariance `obs_noise_cov`,

utkiobj = EnsembleKalmanProcess(y, obs_noise_cov, TransformUnscented(prior))</code></pre><p>The rest of the inversion process is the same as for regular UKI.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ensemble_kalman_sampler/">« Ensemble Kalman Sampler</a><a class="docs-footer-nextpage" href="../learning_rate_scheduler/">Learning rate schedulers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 12 August 2025 05:48">Tuesday 12 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
