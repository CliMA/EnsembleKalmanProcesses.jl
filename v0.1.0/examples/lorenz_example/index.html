<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Lorenz Example · EnsembleKalmanProcesses.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">EnsembleKalmanProcesses.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../../parameter_distributions/">Prior distributions</a></li><li><a class="tocitem" href="../../observations/">Observations</a></li><li><a class="tocitem" href="../../ensemble_kalman_inversion/">Ensemble Kalman Inversion</a></li><li><a class="tocitem" href="../../ensemble_kalman_sampler/">Ensemble Kalman Sampler</a></li><li><a class="tocitem" href="../../unscented_kalman_inversion/">Unscented Kalman Inversion</a></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox" checked/><label class="tocitem" for="menuitem-8"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../template_example/">Template Example</a></li><li><a class="tocitem" href="../Cloudy_example/">Cloudy Example</a></li><li class="is-active"><a class="tocitem" href>Lorenz Example</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Lorenz-96-equations"><span>Lorenz 96 equations</span></a></li><li><a class="tocitem" href="#Structure"><span>Structure</span></a></li><li><a class="tocitem" href="#Lorenz-dynamics-inputs"><span>Lorenz dynamics inputs</span></a></li><li><a class="tocitem" href="#Setting-up-the-Inverse-Problem"><span>Setting up the Inverse Problem</span></a></li><li><a class="tocitem" href="#Running-the-Example"><span>Running the Example</span></a></li><li><a class="tocitem" href="#Solution-and-Output"><span>Solution and Output</span></a></li></ul></li><li><a class="tocitem" href="../ClimateMachine_example/">HPC interfacing example: ClimateMachine</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../API/EnsembleKalmanProcessModule/">EnsembleKalmanProcessModule</a></li><li><a class="tocitem" href="../../API/ParameterDistribution/">ParameterDistribution</a></li><li><a class="tocitem" href="../../API/Observations/">Observations</a></li><li><a class="tocitem" href="../../API/DataStorage/">DataStorage</a></li></ul></li><li><a class="tocitem" href="../../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Lorenz Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Lorenz Example</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/EnsembleKalmanProcesses.jl/blob/master/docs/src/examples/lorenz_example.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Lorenz-96-example"><a class="docs-heading-anchor" href="#Lorenz-96-example">Lorenz 96 example</a><a id="Lorenz-96-example-1"></a><a class="docs-heading-anchor-permalink" href="#Lorenz-96-example" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>The Lorenz 96 (hereafter L96) example is a toy-problem for the application of the EnsembleKalmanProcesses.jl optimization and approximate uncertainty quantification methodologies. Here is L96 with additional periodic-in-time forcing, we try to determine parameters (sinusoidal amplitude and stationary component of the forcing) from some output statistics. The standard L96 equations are implemented with an additional forcing term with time dependence. The output statistics which are used for learning are the finite time-averaged variances.</p><h2 id="Lorenz-96-equations"><a class="docs-heading-anchor" href="#Lorenz-96-equations">Lorenz 96 equations</a><a id="Lorenz-96-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Lorenz-96-equations" title="Permalink"></a></h2><p>The standard single-scale L96 equations are implemented. The Lorenz 96 system (<a href="http://www.raidl.cz/file/18/lorenz-1996-_predictability_partly_solved.pdf">Lorenz, 1996</a>) is given by </p><p class="math-container">\[\frac{d x_i}{d t} = (x_{i+1} - x_{i-2}) x_{i-1} - x_i + F,\]</p><p>with <span>$i$</span> indicating the index of the given longitude. The number of longitudes is given by <span>$N$</span>. The boundary conditions are given by</p><p class="math-container">\[x_{-1} = x_{N-1}, \ x_0 = x_N, \ x_{N+1} = x_1.\]</p><p>The time scaling is such that the characteristic time is 5 days (<a href="http://www.raidl.cz/file/18/lorenz-1996-_predictability_partly_solved.pdf">Lorenz, 1996</a>).  For very small values of <span>$F$</span>, the solutions <span>$x_i$</span> decay to <span>$F$</span> after the initial transient feature. For moderate values of <span>$F$</span>, the solutions are periodic, and for larger values of <span>$F$</span>, the system is chaotic. The solution variance is a function of the forcing magnitude. Variations in the base state as a function of time can be imposed through a time-dependent forcing term <span>$F(t)$</span>.</p><p>A temporal forcing term is defined</p><p class="math-container">\[F = F_s + A \sin(\omega t),\]</p><p>with steady-state forcing <span>$F_s$</span>, transient forcing amplitude <span>$A$</span>, and transient forcing frequency <span>$\omega$</span>. The total forcing <span>$F$</span> must be within the chaotic regime of L96 for all time given the prescribed <span>$N$</span>.</p><p>The L96 dynamics are solved with RK4 integration.</p><h2 id="Structure"><a class="docs-heading-anchor" href="#Structure">Structure</a><a id="Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Structure" title="Permalink"></a></h2><p>The main code is located in <code>Lorenz_example.jl</code> which provides the functionality to run the L96 dynamical system, extract time-averaged statistics from the L96 states, and use the time-average statistics for optimization and uncertainty quantification.</p><p>The L96 system is solved in <code>GModel.jl</code> according to the time integration settings specified in <code>LSettings</code> and the L96 parameters specified in <code>LParams</code>. The types of statistics to be collected are detailed in <code>GModel.jl</code>.</p><h2 id="Lorenz-dynamics-inputs"><a class="docs-heading-anchor" href="#Lorenz-dynamics-inputs">Lorenz dynamics inputs</a><a id="Lorenz-dynamics-inputs-1"></a><a class="docs-heading-anchor-permalink" href="#Lorenz-dynamics-inputs" title="Permalink"></a></h2><h3 id="Dynamics-settings"><a class="docs-heading-anchor" href="#Dynamics-settings">Dynamics settings</a><a id="Dynamics-settings-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamics-settings" title="Permalink"></a></h3><p>The use of the transient forcing term is with the flag, <code>dynamics</code>. Stationary forcing is <code>dynamics=1</code> (<span>$A=0$</span>) and transient forcing is used with <code>dynamics=2</code> (<span>$A\neq0$</span>). The default parameters are specified in <code>Lorenz_example.jl</code> and can be modified as necessary. The system is solved over time horizon <span>$0$</span> to <code>tend</code> at fixed time step <code>dt</code>.</p><pre><code class="language-julia hljs">N = 36
dt = 1/64
t_start = 800</code></pre><h3 id="Inverse-problem-settings"><a class="docs-heading-anchor" href="#Inverse-problem-settings">Inverse problem settings</a><a id="Inverse-problem-settings-1"></a><a class="docs-heading-anchor-permalink" href="#Inverse-problem-settings" title="Permalink"></a></h3><p>The states are integrated over time <code>Ts_days</code> to construct the time averaged statistics for use by the optimization. The specification of the statistics to be gathered from the states are provided by <code>stats_type</code>. The Ensemble Kalman Process (EKP) settings are</p><pre><code class="language-julia hljs">N_ens = 20 # number of ensemble members
N_iter = 5 # number of EKI iterations</code></pre><h2 id="Setting-up-the-Inverse-Problem"><a class="docs-heading-anchor" href="#Setting-up-the-Inverse-Problem">Setting up the Inverse Problem</a><a id="Setting-up-the-Inverse-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-the-Inverse-Problem" title="Permalink"></a></h2><p>The goal is to learn <code>F_s</code> and <code>A</code> based on the time averaged statistics in a perfect model setting. The true parameters are</p><pre><code class="language-julia hljs">F_true = 8. # Mean F
A_true = 2.5 # Transient F amplitude
ω_true = 2. * π / (360. / τc) # Frequency of the transient F
params_true = [F_true, A_true]
param_names = [&quot;F&quot;, &quot;A&quot;]</code></pre><h3 id="Priors"><a class="docs-heading-anchor" href="#Priors">Priors</a><a id="Priors-1"></a><a class="docs-heading-anchor-permalink" href="#Priors" title="Permalink"></a></h3><p>We use normal priors without constraints</p><pre><code class="language-julia hljs">prior_means = [F_true+1.0, A_true+0.5]
prior_stds = [2.0, 0.5*A_true]
d1 = Parameterized(Normal(prior_means[1], prior_stds[1]))
d2 = Parameterized(Normal(prior_means[2], prior_stds[2]))
prior_distns = [d1, d2]
c1 = no_constraint()
c2 = no_constraint()
constraints = [[c1], [c2]]
prior_names = param_names
priors = ParameterDistribution(prior_distns, constraints, prior_names)</code></pre><h3 id="Observational-Noise"><a class="docs-heading-anchor" href="#Observational-Noise">Observational Noise</a><a id="Observational-Noise-1"></a><a class="docs-heading-anchor-permalink" href="#Observational-Noise" title="Permalink"></a></h3><p>The observational noise can be generated using the L96 system or prescribed, as specified by <code>var_prescribe</code>. </p><p><code>var_prescribe==false</code> The observational noise is constructed by generating independent instantiations of the L96 statistics of interest at the true parameters for different initial conditions. The empirical covariance matrix is constructed.</p><p><code>var_prescribe==true</code> The observational noise is prescribed as a Gaussian distribution with prescribed mean and variance.</p><h2 id="Running-the-Example"><a class="docs-heading-anchor" href="#Running-the-Example">Running the Example</a><a id="Running-the-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-Example" title="Permalink"></a></h2><p>The L96 parameter estimation can be run using <code>julia --project Lorenz_example.jl</code></p><h2 id="Solution-and-Output"><a class="docs-heading-anchor" href="#Solution-and-Output">Solution and Output</a><a id="Solution-and-Output-1"></a><a class="docs-heading-anchor-permalink" href="#Solution-and-Output" title="Permalink"></a></h2><p>The output will provide the estimated parameters.</p><h3 id="Printed-output"><a class="docs-heading-anchor" href="#Printed-output">Printed output</a><a id="Printed-output-1"></a><a class="docs-heading-anchor-permalink" href="#Printed-output" title="Permalink"></a></h3><pre><code class="language-julia hljs"># EKI results: Has the ensemble collapsed toward the truth?
println(&quot;True parameters: &quot;)
println(params_true)
println(&quot;\nEKI results:&quot;)
println(mean(get_u_final(ekiobj), dims=2))</code></pre><h3 id="Saved-output"><a class="docs-heading-anchor" href="#Saved-output">Saved output</a><a id="Saved-output-1"></a><a class="docs-heading-anchor-permalink" href="#Saved-output" title="Permalink"></a></h3><p>The parameters and forward model outputs will be saved in <code>parameter_storage.jld2</code> and <code>data_storage.jld2</code>, respectively. The data will be saved in the directory <code>output</code>.</p><h3 id="Plots"><a class="docs-heading-anchor" href="#Plots">Plots</a><a id="Plots-1"></a><a class="docs-heading-anchor-permalink" href="#Plots" title="Permalink"></a></h3><p>A scatter plot of the parameter estimates compared to the true parameters will be provided in the directory <code>output</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Cloudy_example/">« Cloudy Example</a><a class="docs-footer-nextpage" href="../ClimateMachine_example/">HPC interfacing example: ClimateMachine »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.5 on <span class="colophon-date" title="Friday 6 August 2021 16:52">Friday 6 August 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
