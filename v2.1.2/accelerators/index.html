<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Accelerators · EnsembleKalmanProcesses.jl</title><meta name="title" content="Accelerators · EnsembleKalmanProcesses.jl"/><meta property="og:title" content="Accelerators · EnsembleKalmanProcesses.jl"/><meta property="twitter:title" content="Accelerators · EnsembleKalmanProcesses.jl"/><meta name="description" content="Documentation for EnsembleKalmanProcesses.jl."/><meta property="og:description" content="Documentation for EnsembleKalmanProcesses.jl."/><meta property="twitter:description" content="Documentation for EnsembleKalmanProcesses.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="EnsembleKalmanProcesses.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">EnsembleKalmanProcesses.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation_instructions/">Installation instructions</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../literated/sinusoid_example/">Simple example</a></li><li><a class="tocitem" href="../examples/Cloudy_example/">Cloudy</a></li><li><a class="tocitem" href="../examples/lorenz_example/">Lorenz</a></li><li><a class="tocitem" href="../literated/loss_minimization/">Minimization Loss</a></li><li><a class="tocitem" href="../literated/loss_minimization_sparse_eki/">Sparse Minimization Loss</a></li><li><a class="tocitem" href="../literated/aerosol_activation/">Aerosol activation</a></li><li><a class="tocitem" href="../examples/darcy/">Darcy flow</a></li><li><a class="tocitem" href="../examples/sinusoid_example_toml/">TOML interface</a></li><li><a class="tocitem" href="../examples/ClimateMachine_example/">HPC interfacing example: ClimateMachine</a></li><li><a class="tocitem" href="../examples/template_example/">Template</a></li></ul></li><li><a class="tocitem" href="../defaults/">List of default configurations</a></li><li><a class="tocitem" href="../ensemble_kalman_inversion/">Ensemble Kalman Inversion</a></li><li><a class="tocitem" href="../gauss_newton_kalman_inversion/">Gauss Newton Kalman Inversion</a></li><li><a class="tocitem" href="../ensemble_kalman_sampler/">Ensemble Kalman Sampler</a></li><li><a class="tocitem" href="../unscented_kalman_inversion/">Unscented Kalman Inversion</a></li><li><a class="tocitem" href="../learning_rate_scheduler/">Learning rate schedulers</a></li><li><a class="tocitem" href="../parameter_distributions/">Prior distributions</a></li><li><a class="tocitem" href="../observations/">Observations and Minibatching</a></li><li><a class="tocitem" href="../update_groups/">Update Groups</a></li><li><a class="tocitem" href="../localization/">Localization and SEC</a></li><li class="is-active"><a class="tocitem" href>Accelerators</a><ul class="internal"><li><a class="tocitem" href="#Using-Accelerators"><span>Using Accelerators</span></a></li><li><a class="tocitem" href="#Experiments-on-EKI-and-ETKI"><span>Experiments on EKI and ETKI</span></a></li><li><a class="tocitem" href="#Background-and-Implementation"><span>Background &amp; Implementation</span></a></li></ul></li><li><a class="tocitem" href="../inflation/">Inflation</a></li><li><a class="tocitem" href="../parallel_hpc/">Parallelism and HPC</a></li><li><a class="tocitem" href="../internal_data_representation/">Internal data representation</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li><input class="collapse-toggle" id="menuitem-19" type="checkbox"/><label class="tocitem" for="menuitem-19"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../API/ParameterDistributions/">ParameterDistributions</a></li><li><a class="tocitem" href="../API/Observations/">Observations</a></li><li><a class="tocitem" href="../API/DataContainers/">DataContainers</a></li><li><a class="tocitem" href="../API/EnsembleKalmanProcess/">EnsembleKalmanProcess</a></li><li><a class="tocitem" href="../API/Inversion/">Inversion</a></li><li><a class="tocitem" href="../API/Unscented/">Unscented</a></li><li><a class="tocitem" href="../API/Sampler/">Sampler</a></li><li><a class="tocitem" href="../API/SparseInversion/">SparseInversion</a></li><li><a class="tocitem" href="../API/TOMLInterface/">TOML Interface</a></li><li><a class="tocitem" href="../API/Localizers/">Localizers</a></li></ul></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Accelerators</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Accelerators</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/EnsembleKalmanProcesses.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/EnsembleKalmanProcesses.jl/blob/main/docs/src/accelerators.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Accelerators"><a class="docs-heading-anchor" href="#Accelerators">Accelerators</a><a id="Accelerators-1"></a><a class="docs-heading-anchor-permalink" href="#Accelerators" title="Permalink"></a></h1><p>We provide options to accelerate the convergence of some optimizer variants with <a href="https://github.com/CliMA/EnsembleKalmanProcesses.jl/blob/main/src/Accelerators.jl">accelerators</a>. These accelerators have been adapted from gradient-based methods in order to accelerate the following ensemble Kalman processes:</p><ul><li>Ensemble Kalman inversion (EKI), <code>Inversion()</code></li><li>Ensemble transform Kalman inversion (ETKI), <code>TransformInversion()</code></li><li>Unscented Kalman inversion (UKI), <code>Unscented()</code> (experimental, may result in instability)</li><li>Ensemble Kalman sampler (EKS), <code>Sampler()</code> (experimental, may result in instability)</li></ul><p>Further theoretical details and experiments of the accelerators, please see <a href="https://doi.org/10.48550/arXiv.2501.08779">(Vernon, Bach, Dunbar, 2025)</a></p><h2 id="Using-Accelerators"><a class="docs-heading-anchor" href="#Using-Accelerators">Using Accelerators</a><a id="Using-Accelerators-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Accelerators" title="Permalink"></a></h2><p>An EKI struct can be created with acceleration as follows:</p><pre><code class="language-julia hljs"># assume we have defined an initial ensemble, a vector of observations y, and observational noise covariance Γ

ekiobj_accelerated = EKP.EnsembleKalmanProcess(
            initial_ensemble,
            y,
            Γ,
            Inversion();
            accelerator = NesterovAccelerator()
        )</code></pre><p>The rest of the process is the same as without the accelerator.</p><p>Very similarly, one can create an ETKI struct with acceleration:</p><pre><code class="language-julia hljs">etkiobj_accelerated = EKP.EnsembleKalmanProcess(
            initial_ensemble,
            y,
            Γ,
            TransformInversion();
            accelerator = NesterovAccelerator()
        )</code></pre><p>Again, the rest of the process is the same as without the accelerator.</p><h2 id="Experiments-on-EKI-and-ETKI"><a class="docs-heading-anchor" href="#Experiments-on-EKI-and-ETKI">Experiments on EKI and ETKI</a><a id="Experiments-on-EKI-and-ETKI-1"></a><a class="docs-heading-anchor-permalink" href="#Experiments-on-EKI-and-ETKI" title="Permalink"></a></h2><p>Accelerators have been found to accelerate EKI convergence on a number of example inverse problems. In this &quot;exponential sine&quot; inverse problem, we look to solve for amplitude and vertical shift parameters of an underlying sine wave. The model is defined as <span>$\exp\left(\theta_1 \sin(\phi+t) + \theta_2\right)$</span>, with unknown parameters <span>$\theta = [\theta_1, \theta_2]$</span>. Observations (model output) consist of the difference between maximum and minimum, and the mean, of the evaluated model. We define <span>$\theta_\text{true} = \left[1, 0.8\right]$</span>.</p><p>The <code>NesterovAccelerator()</code> (shown in blue) has been found to produce the most consistent acceleration on this problem, as seen below. The <code>FirstOrderNesterovAccelerator()</code> (shown in red) uses a momentum coefficient very similar to that of the <code>NesterovAccelerator()</code>, and enjoys similar performance. The <code>ConstantNesterovAccelerator(0.9)</code> (shown in green) is effective in this test case, but can be very unstable. These methods differ only in their momentum coefficient values, which are plotted on the right. Vanilla EKI is shown in black. The experiment is repeated 50 times; ribbons denote one standard error from the mean.</p><p><img src="../assets/coeff_comparison_ens25.png" alt="Momentum coefficients"/> <img src="../assets/coeff_evolution_exp_sin.png" alt="Momentum coefficient values"/></p><p>Below is an example of accelerated ETKI convergence on the same problem, using the <code>NesterovAccelerator()</code>.</p><p><img src="../assets/etki_momentum.png" alt="etki momentum"/> <img src="../assets/uki_momentum.png" alt="uki momentum"/></p><h2 id="Background-and-Implementation"><a class="docs-heading-anchor" href="#Background-and-Implementation">Background &amp; Implementation</a><a id="Background-and-Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Background-and-Implementation" title="Permalink"></a></h2><h3 id="Nesterov-Acceleration-for-Gradient-Descent"><a class="docs-heading-anchor" href="#Nesterov-Acceleration-for-Gradient-Descent">Nesterov Acceleration for Gradient Descent</a><a id="Nesterov-Acceleration-for-Gradient-Descent-1"></a><a class="docs-heading-anchor-permalink" href="#Nesterov-Acceleration-for-Gradient-Descent" title="Permalink"></a></h3><p>In traditional gradient descent, one iteratively solves for <span>$x^*$</span>, the minimizer of a function <span>$f(x)$</span>, by performing the update step </p><p class="math-container">\[x_{k+1} = x_{k} + \alpha  \nabla f(x_{k}), \]</p><p>where <span>$\alpha$</span> is a step size parameter. In 1983, Nesterov acceleration (also known as Nesterov momentum) was introduced to accelerate gradient descent. In the modified algorithm, the update step becomes </p><p class="math-container">\[x_{k+1} = x_{k} + \beta (x_{k} - x_{k-1}) + \alpha  \nabla f(x_{k} + \beta (x_{k} - x_{k-1})), \]</p><p>where <span>$\beta$</span> is a momentum coefficient. Intuitively, the method mimics a ball gaining speed while rolling down a constantly-sloped hill.</p><h3 id="Implementation-in-EKI-Algorithm"><a class="docs-heading-anchor" href="#Implementation-in-EKI-Algorithm">Implementation in EKI Algorithm</a><a id="Implementation-in-EKI-Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-in-EKI-Algorithm" title="Permalink"></a></h3><p>The exact implementation, theory, and experiments for this work are available at <a href="https://doi.org/10.48550/arXiv.2501.08779">(Vernon, Bach, Dunbar, 2025)</a>.</p><p>Nesterov acceleration can be used to accelerate gradient flows, as shown by <a href="https://arxiv.org/abs/1503.01243">(Su et al 2016)</a>. EKI, a gradient-free method, can be understood as approximating a form of gradient flow <a href="https://arxiv.org/abs/2209.11371">(Calvello et al 2023)</a>). Additionally, work by <a href="https://iopscience.iop.org/article/10.1088/1361-6420/ab1c3a">(Kovachki and Stuart 2021)</a> demonstrated success when using a modified particle-based Nesterov acceleration method. This work inspired the following implementation of accelerators for a variety of EKP processes.</p><p>The traditional update step for EKI is as follows, with <span>$j = 1, ..., J$</span> denoting the ensemble member and <span>$k$</span> denoting iteration number.</p><p class="math-container">\[u_{k+1}^j = u_{k}^j + C_{k}^{u\mathcal{G}} (\frac{1}{\Delta t}\Gamma + C^{\mathcal{G}\mathcal{G}}_k)^{-1} \left(y - \mathcal{G}(u_k^j)\right)\]</p><p>When using accelerators, this update step is modified to include a term reminiscent of that in Nesterov&#39;s acceleration method for gradient descent.</p><p>We first compute intermediate values:</p><p class="math-container">\[v_k^j = u_k^j+ \beta_k (u_k^j - u_{k-1}^j)\]</p><p>We then update the ensemble:</p><p class="math-container">\[u_{k+1}^j = v_{k}^j + C_{k}^{u\mathcal{G}} (\frac{1}{\Delta t}\Gamma + C^{\mathcal{G}\mathcal{G}}_k)^{-1} \left(y - \mathcal{G}(v_k^j)\right)\]</p><p>The momentum coefficient <span>$\beta_k$</span> here differs for different accelerators.</p><ul><li>In the <code>NesterovAccelerator()</code>, we recursively compute <span>$\beta_k$</span> as <span>$\beta_k = \theta_k(\theta_{k-1}^{-1}-1)$</span> in the  as derived in (<a href="https://jmlr.org/papers/v17/15-084.html">Su et al</a>). This implementation has generally been found to be the most effective in most test cases.</li><li>In the <code>FirstOrderNesterovAccelerator()</code>, we compute <span>$\beta_k = 1-3k^{-1}$</span>. This is the coefficient originally used by Nesterov.</li><li>The <code>ConstantNesterovAccelerator()</code> uses a specified constant coefficient, with the default being <span>$\beta_k = 0.9$</span>.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../localization/">« Localization and SEC</a><a class="docs-footer-nextpage" href="../inflation/">Inflation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Saturday 8 March 2025 16:21">Saturday 8 March 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
